<div class="chat-container">
  <div class="sidebar">
    <mat-tab-group>
      <!-- Contacts Tab -->
      <mat-tab label="Contacts">
        <div class="contacts-container">
          <div *ngIf="isLoadingContacts" class="loading-indicator">
            <p>Loading contacts...</p>
          </div>

          <div *ngIf="!isLoadingContacts && contacts.length === 0" class="empty-state">
            <p>No contacts yet. Search for users to connect with.</p>
          </div>

          <mat-list *ngIf="!isLoadingContacts && contacts.length > 0">
            <mat-list-item *ngFor="let contact of contacts"
                          [class.selected]="selectedContact?.id === contact.id"
                          (click)="selectContact(contact)">
              <img matListItemAvatar [src]="contact.profilePictureUrl || 'assets/default-avatar.png'" alt="Profile picture">
              <div matListItemTitle>{{ contact.firstName }} {{ contact.lastName }}</div>
              <div matListItemLine>{{ contact.email }}</div>
            </mat-list-item>
          </mat-list>
        </div>
      </mat-tab>

      <!-- Search Tab -->
      <mat-tab label="Search">
        <div class="search-container">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search users</mat-label>
            <input matInput [(ngModel)]="searchQuery" (keyup.enter)="searchUsers()">
            <button mat-icon-button matSuffix (click)="searchUsers()">
              <mat-icon>search</mat-icon>
            </button>
          </mat-form-field>

          <div *ngIf="isSearching" class="loading-indicator">
            <p>Searching...</p>
          </div>

          <div *ngIf="!isSearching && searchResults.length === 0 && searchQuery" class="empty-state">
            <p>No users found matching "{{ searchQuery }}"</p>
          </div>

          <mat-list *ngIf="!isSearching && searchResults.length > 0">
            <mat-list-item *ngFor="let user of searchResults">
              <img matListItemAvatar [src]="user.profilePictureUrl || 'assets/default-avatar.png'" alt="Profile picture">
              <div matListItemTitle>{{ user.firstName }} {{ user.lastName }}</div>
              <div matListItemLine>{{ user.email }}</div>
              <button mat-icon-button color="primary" (click)="sendContactRequest(user.id)" matTooltip="Send contact request">
                <mat-icon>person_add</mat-icon>
              </button>
            </mat-list-item>
          </mat-list>
        </div>
      </mat-tab>

      <!-- Requests Tab -->
      <mat-tab label="Requests" [disabled]="pendingRequests.length === 0">
        <div class="requests-container">
          <div *ngIf="isLoadingRequests" class="loading-indicator">
            <p>Loading requests...</p>
          </div>

          <div *ngIf="!isLoadingRequests && pendingRequests.length === 0" class="empty-state">
            <p>No pending contact requests</p>
          </div>

          <mat-list *ngIf="!isLoadingRequests && pendingRequests.length > 0">
            <mat-list-item *ngFor="let request of pendingRequests">
              <img matListItemAvatar src="assets/default-avatar.png" alt="Profile picture">
              <div matListItemTitle>{{ request.requesterName }}</div>
              <div matListItemLine>Sent you a contact request</div>
              <div class="request-actions">
                <button mat-icon-button color="primary" (click)="acceptContactRequest(request.id)" matTooltip="Accept">
                  <mat-icon>check</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="rejectContactRequest(request.id)" matTooltip="Reject">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </mat-list-item>
          </mat-list>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <div class="chat-area">
    <div *ngIf="!selectedContact" class="no-chat-selected">
      <mat-icon class="large-icon">chat</mat-icon>
      <h2>Select a contact to start chatting</h2>
    </div>

    <div *ngIf="selectedContact" class="chat-content">
      <div class="chat-header">
        <img [src]="selectedContact.profilePictureUrl || 'assets/default-avatar.png'" alt="Profile picture">
        <div class="contact-info">
          <h3>{{ selectedContact.firstName }} {{ selectedContact.lastName }}</h3>
          <p>{{ selectedContact.email }}</p>
        </div>
      </div>

      <div class="messages-container">
        <div *ngIf="isLoadingMessages" class="loading-indicator">
          <p>Loading messages...</p>
        </div>

        <div *ngIf="!isLoadingMessages && messages.length === 0" class="empty-state">
          <p>No messages yet. Start the conversation!</p>
        </div>

        <div *ngIf="totalMessages > messages.length" class="load-more">
          <button mat-button (click)="loadMoreMessages()">Load more messages</button>
        </div>

        <div class="message-list">
          <div *ngFor="let message of messages"
               [ngClass]="{'message': true, 'sent': message.senderId !== selectedContact.id, 'received': message.senderId === selectedContact.id}">
            <div class="message-content">
              <p>{{ message.content }}</p>
              <span class="message-time">{{ message.timestamp | date:'short' }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="message-input">
        <mat-form-field appearance="outline" class="message-field">
          <mat-label>Type a message</mat-label>
          <input matInput [(ngModel)]="newMessage" (keyup.enter)="sendMessage()">
          <button mat-icon-button matSuffix (click)="sendMessage()" [disabled]="!newMessage.trim()">
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
  </div>
</div>
